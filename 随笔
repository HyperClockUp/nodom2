2018-05-26
页面流控制：
页面流程由流程控制器进行管理，用户需要在流程配置文件对整个应用的流程进行配置，好处是，模块只需要处理模块内部的逻辑，外部逻辑由流程控制器管理，让每个模块完全独立。
需要考虑的问题：
是否还需要路由，如果不需要路由，则怎么解决刷新问题？
考虑的解决方案是对流程编号，用编号管理流程历史，每个历史节点需要保存节点的输入。
流程控制的关键要素：
1、流程控制器
2、历史管理器
3、模块数据缓存（最后实现）


编译和渲染改虚拟dom方式
用json对象存储dom树

htmldom节点增加domid属性，用于和虚拟dom的domid保持一致，刷新时使用。
渲染分为三步：第一步，虚拟dom渲染；第二步，对比新的虚拟dom和老的虚拟dom，找到需要渲染到html dom的节点；第三步，更新到html dom。
首次渲染，需要构建html dom，并根据domid 生成器，给每个htmldom 增加虚拟domid。
二次及以后渲染，如果存在新增dom的情况，需要增加domid，另外的domid不变。
每次渲染，都从原始虚拟dom（编译后的）进行渲染，每次都需要构建新的虚拟dom，和旧的虚拟dom进行比较，新虚拟dom渲染到html dom后，用新的虚拟dom替换旧的虚拟dom。

model隔离问题，怎么做到修改后的数据进行计算，未修改的不进行渲染。

show指令导致的dom显示和删除问题
if-else指令导致的dom替换问题
repeat指令导致的dom增减问题

节点问题：无非是增减、替换、修改属性
保证原始定义的节点问题
表达式放置方式: attrs:[{attrname1:id1},{attrname2:id2},...],attrname为属性名，id为表达式id
指令放置方式:directives:[id1,id2,...,idn]，id为指令id，需要按照优先级排序（代确定）。

虚拟dom比较方法树形比较，比较完毕后，需要设置修改类别（替换，改属性，增加，删除）。
替换：找到domid对应的htmldom，直接用父node或前置node进行原htmldom删除，增加新dom，domid不变。
改属性：找到domid对应的htmldom，修改属性即可。
增加：比较简单的方式就是父节点如果有多个子节点的话，看子节点个数进行追加，追加的节点生成新的domid。
删除：直接找到domid对应htmldom进行删除，这个也是看父节点的子节点情况。
插入节点的情况，这样做需要更换所有节点属性。
解决办法：统计新子节点>旧子节点数量？如果大于，则核对domid，怎么核对？新的虚拟dom还没有domid，怎么弄？


Router.start 方法闭包变量使用出错，需要修改

history回退时，路由不变的情况下，active有问题



